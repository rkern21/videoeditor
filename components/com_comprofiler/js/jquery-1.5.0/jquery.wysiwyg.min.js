/**
 * WYSIWYG - jQuery plugin 1.0
 *
 * Copyright (c) 2007 Juan M Martinez
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Revision: $Id$
 */(function(a){function b(a,c){return this instanceof b?this.init(a,c):new b(a,c)}a.fn.document=function(){var b=this[0];return b.nodeName.toLowerCase()=="iframe"?b.contentWindow.document:a(this)},a.fn.wysiwyg=function(c){if(arguments.length>0&&arguments[0].constructor==String){var d=arguments[0]+"",e=[];for(var f=1;f<arguments.length;f++)e[f-1]=arguments[f];return d in b?this.each(function(){b[d].apply(this,e)}):this}var g={};if(c&&c.length>0&&c.controls){var g=c.controls;delete c.controls}var c=a.extend({html:'<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body>INITIAL_CONTENT</body></html>',debug:!1,autoSave:!0,controls:{}},c);a.extend(c.controls,b.TOOLBAR,g);return this.each(function(){b(this,c)})},a.extend(b,{insertImage:function(c){var d=a.data(this,"wysiwyg");d.constructor==b&&d.editorDoc.execCommand("insertImage",!1,c)},createLink:function(c){var d=a.data(this,"wysiwyg");d.constructor==b&&d.editorDoc.execCommand("createLink",!1,c)},TOOLBAR:{bold:{visible:!0,tags:["b","strong"],css:{fontWeight:"bold"}},italic:{visible:!0,tags:["i","em"],css:{fontStyle:"italic"}},strikeThrough:{visible:!1,tags:["s","strike"],css:{textDecoration:"line-through"}},underline:{visible:!1,tags:["u"],css:{textDecoration:"underline"}},separator00:{visible:!1,separator:!0},justifyLeft:{visible:!1,css:{textAlign:"left"}},justifyCenter:{visible:!1,tags:["center"],css:{textAlign:"center"}},justifyRight:{visible:!1,css:{textAlign:"right"}},justifyFull:{visible:!1,css:{textAlign:"justify"}},separator01:{visible:!1,separator:!0},indent:{visible:!1},outdent:{visible:!1},separator02:{visible:!1,separator:!0},subscript:{visible:!1,tags:["sub"]},superscript:{visible:!1,tags:["sup"]},separator03:{visible:!1,separator:!0},undo:{visible:!1},redo:{visible:!1},separator04:{visible:!1,separator:!0},insertOrderedList:{visible:!1,tags:["ol"]},insertUnorderedList:{visible:!1,tags:["ul"]},insertHorizontalRule:{visible:!1,tags:["hr"]},separator05:{separator:!0},createLink:{visible:!0,exec:function(b){if(a.browser.msie)b.editorDoc.execCommand("createLink",!0,null);else{var c=prompt("URL","http://");c&&c.length>0&&b.editorDoc.execCommand("createLink",!1,c)}},tags:["a"]},insertImage:{visible:!0,exec:function(b){if(a.browser.msie)b.editorDoc.execCommand("insertImage",!0,null);else{var c=prompt("URL","http://");c&&c.length>0&&b.editorDoc.execCommand("insertImage",!1,c)}},tags:["img"]},separator06:{separator:!0},h1mozilla:{visible:!0&&a.browser.mozilla,className:"h1",command:"heading",arguments:["h1"],tags:["h1"]},h2mozilla:{visible:!0&&a.browser.mozilla,className:"h2",command:"heading",arguments:["h2"],tags:["h2"]},h3mozilla:{visible:!0&&a.browser.mozilla,className:"h3",command:"heading",arguments:["h3"],tags:["h3"]},h1:{visible:!0&&!a.browser.mozilla,className:"h1",command:"formatBlock",arguments:["h1"],tags:["h1"]},h2:{visible:!0&&!a.browser.mozilla,className:"h2",command:"formatBlock",arguments:["h2"],tags:["h2"]},h3:{visible:!0&&!a.browser.mozilla,className:"h3",command:"formatBlock",arguments:["h3"],tags:["h3"]},separator07:{visible:!1,separator:!0},cut:{visible:!1},copy:{visible:!1},paste:{visible:!1},separator08:{separator:!0&&!a.browser.msie},increaseFontSize:{visible:!0&&!a.browser.msie,tags:["big"]},decreaseFontSize:{visible:!0&&!a.browser.msie,tags:["small"]},separator09:{separator:!0},html:{visible:!0,exec:function(b){b.viewHTML?(b.setContent(a(b.original).val()),a(b.original).hide()):(b.saveContent(),a(b.original).show()),b.viewHTML=!b.viewHTML}},removeFormat:{visible:!0,exec:function(a){a.editorDoc.execCommand("removeFormat",!1,[]),a.editorDoc.execCommand("unlink",!1,[])}}}}),a.extend(b.prototype,{original:null,options:{},element:null,editor:null,init:function(b,c){var d=this;this.editor=b,this.options=c||{},a.data(b,"wysiwyg",this);var e=b.width||b.clientWidth,f=b.height||b.clientHeight;if(b.nodeName.toLowerCase()=="textarea"){this.original=b,e==0&&b.cols&&(e=b.cols*8+21),f==0&&b.rows&&(f=b.rows*16+16);var g=this.editor=a("<iframe></iframe>").css({minHeight:f-6+""+"px",width:e-8+""+"px"}).attr("id",a(b).attr("id")+"IFrame");a.browser.msie&&this.editor.css("height",f+""+"px")}var h=this.panel=a("<ul></ul>").addClass("panel");this.appendControls(),this.element=a("<div></div>").css({width:e>0?e+""+"px":"100%"}).addClass("wysiwyg").append(h).append(a("<div><!-- --></div>").css({clear:"both"})).append(g),a(b).hide().before(this.element),this.viewHTML=!1,this.initialHeight=f-8,this.initialContent=a(b).text(),this.initFrame(),this.initialContent.length==0&&this.setContent("<br />"),this.options.autoSave&&a("form").submit(function(){d.saveContent()})},initFrame:function(){var b=this;this.editorDoc=a(this.editor).document(),this.editorDoc.open(),this.editorDoc.write(this.options.html.replace(/INITIAL_CONTENT/,this.initialContent)),this.editorDoc.close(),this.editorDoc.contentEditable="true",this.editorDoc_designMode=!1;try{this.editorDoc.designMode="on",this.editorDoc_designMode=!0}catch(c){a(this.editorDoc).focus(function(){if(!b.editorDoc_designMode)try{b.editorDoc.designMode="on",b.editorDoc_designMode=!0}catch(a){}})}a(this.editorDoc).click(function(a){b.checkTargets(a.target?a.target:a.srcElement)}),this.options.autoSave&&a(this.editorDoc).keydown(function(){b.saveContent()}).mousedown(function(){b.saveContent()})},getContent:function(){return a(a(this.editor).document()).find("body").html()},setContent:function(b){a(a(this.editor).document()).find("body").html(b)},saveContent:function(){this.original&&a(this.original).val(this.getContent())},appendMenu:function(b,c,d,e){var f=this,c=c||[];a("<li></li>").append(a("<a><!-- --></a>").addClass(d||b)).mousedown(function(){e?e(f):f.editorDoc.execCommand(b,!1,c),f.options.autoSave&&f.saveContent()}).appendTo(this.panel)},appendMenuSeparator:function(){a('<li class="separator"></li>').appendTo(this.panel)},appendControls:function(){for(var a in this.options.controls){var b=this.options.controls[a];b.separator?b.visible!==!1&&this.appendMenuSeparator():b.visible&&this.appendMenu(b.command||a,b.arguments||[],b.className||b.command||a||"empty",b.exec)}},checkTargets:function(b){for(var c in this.options.controls){var d=this.options.controls[c],e=d.className||d.command||c||"empty";a("."+e,this.panel).removeClass("active");if(d.tags){var f=b;do{if(f.nodeType!=1)break;a.inArray(f.tagName.toLowerCase(),d.tags)!=-1&&a("."+e,this.panel).addClass("active")}while(f=f.parentNode)}if(d.css){var f=a(b);do{if(f[0].nodeType!=1)break;for(var g in d.css)(f.css(g)+"").toLowerCase()==d.css[g]&&a("."+e,this.panel).addClass("active")}while(f=f.parent())}}}})})(jQuery)